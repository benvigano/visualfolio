{% extends "main/base.html" %}
{% block title %}
Home
{% endblock title %}
{% block content %}
{% load humanize %}
{% load static %}
<h1 class="font-display font-medium text-2xl text-[--first-text-color] mt-4 mb-6">Home</h1>
<div class="flex flex-col space-y-6">
    <div class="flex justify-between space-x-6 items-end">
    <h2 class="font-medium text-[--first-text-color] -mb-1">Streamgraph</h2>
    <div class="flex space-x-6">
        <div class="flex space-x-4 items-end bg-[--second-bg-color] border border-[--border-color] rounded-xl py-3 px-5">
            <div class="text-xs text-end font-medium text-[--third-text-color] mb-1">Liquid assets value:</div>
            <div class="text-[--first-text-color] text-end text-xl tabular-nums font-normal">
                {{ liquid_asset_value|floatformat:"2"|intcomma }} {{ base_currency }}
            </div>
        </div>
        <div class="flex space-x-4 items-end bg-[--second-bg-color] border border-[--border-color] rounded-xl py-3 px-5">
            <div class="text-xs text-end font-medium text-[--third-text-color] mb-1">Total asset value:</div>
            <div class="text-[--first-text-color] text-end text-xl tabular-nums font-normal">
                {{ total_asset_value|floatformat:"2"|intcomma }} {{ base_currency }}
            </div>
        </div>
    </div>
</div>
    <div class="h-[500px] bg-[--second-bg-color] border border-[--border-color] rounded-xl">{{ graph|safe }}</div>
</div>
<div id="triggerIcon"
     class="fixed bottom-3 right-3 bg-yellow-500 dark:bg-yellow-300 opacity-70 p-2 rounded-full cursor-pointer z-50 flex items-center justify-center hover:bg-yellow-600 hover:dark:bg-yellow-400">
    <svg class="w-6 h-6 text-[--third-bg-color]"
         aria-hidden="true"
         xmlns="http://www.w3.org/2000/svg"
         width="24"
         height="24"
         fill="currentColor"
         viewBox="0 0 24 24">
        <path fill-rule="evenodd"
              d="M7.05 4.05A7 7 0 0 1 19 9c0 2.407-1.197 3.874-2.186 5.084l-.04.048C15.77 15.362 15 16.34 15 18a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1c0-1.612-.77-2.613-1.78-3.875l-.045-.056C6.193 12.842 5 11.352 5 9a7 7 0 0 1 2.05-4.95ZM9 21a1 1 0 0 1 1-1h4a1 1 0 1 1 0 2h-4a1 1 0 0 1-1-1Zm1.586-13.414A2 2 0 0 1 12 7a1 1 0 1 0 0-2 4 4 0 0 0-4 4 1 1 0 0 0 2 0 2 2 0 0 1 .586-1.414Z"
              clip-rule="evenodd"/>
    </svg>
</div>
<div id="walkthroughPopup"
     class="opacity-0 transition-opacity duration-300 ease-in-out fixed bottom-3 right-16 flex items-end justify-end hidden">
    <div class="bg-[--second-bg-color] rounded-2xl border-4 border-[--mid-bg-color] border-opacity-50 p-4 relative">
        <div id="walkthroughContent">

            <div class="flex justify-between items-center space-x-1 mb-8">
                <div class="flex space-x-1 items-center">
                    <h2 class="pl-1 text-[--second-text-color] font-medium">Streamgraph</h2>
                </div>
                <div class="flex h-6 space-x-4 items-center">
                    <span class="text-xs bg-[--third-bg-color] ml-4 py-0.5 px-1 rounded-md font-mono font-semibold text-[--third-text-color]"></span>
                    <button id="nextButton"
                            class="text-mlg bg-yellow-500 rounded-md text-[--second-bg-color] px-3 py-1 font-medium hover:bg-yellow-600">
                        Next
                    </button>
                    <button id="closeButton"
                            class="text-mlg bg-yellow-500 rounded-md text-[--second-bg-color] px-3 py-1 font-medium hover:bg-yellow-600">
                        Close
                    </button>
                </div>
            </div>
            <div class="flex flex-col justify-between space-y-8 items-start">
                <div id="walkthroughIcon"
                     class="relative h-32 w-[18.02083rem] flex items-center justify-center">
                    <img src="" alt="Icon" class=/ style="filter: grayscale(1);">
                </div>
                <p class="w-full text-[--first-text-color] bg-[--first-bg-color] rounded-lg  py-2 px-3 flex-grow-0 flex-shrink-0 whitespace-normal">
                </p>
            </div>
        </div>
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const popup = document.getElementById("walkthroughPopup");
        const content = document.getElementById("walkthroughContent");
        const iconContainer = document.getElementById("walkthroughIcon");
        const nextButton = document.getElementById("nextButton");
        const closeButton = document.getElementById("closeButton");

        let currentPage = 0;
        const darkThemeIcons = [
            "{% static 'main/img/dark_walkthrough_1.svg' %}",
            "{% static 'main/img/dark_walkthrough_2.svg' %}",
            "{% static 'main/img/dark_walkthrough_3.svg' %}"
        ];
        const lightThemeIcons = [
            "{% static 'main/img/light_walkthrough_1.svg' %}",
            "{% static 'main/img/light_walkthrough_2.svg' %}",
            "{% static 'main/img/light_walkthrough_3.svg' %}"
        ];
        const pages = [
        { text: "The <span class='font-bold'>top boundary</span> represents<br> <span class='font-semibold'>transactions</span>." },
        { text: "The <span class='font-bold'>bottom boundary</span> represents<br><span class='font-semibold'>investment profit or loss</span>." },
        { text: "The <span class='font-bold'>thickness</span> of the stream<br>represents <span class='font-semibold'>total asset value</span>." },
        ];

        const isDarkTheme = () => {
            return document.documentElement.classList.contains('dark');
        };

        const getThemeIcons = () => {
            return isDarkTheme() ? darkThemeIcons : lightThemeIcons;
        };

        const showPopup = () => {
            popup.classList.remove("hidden");
        };

        const hidePopup = () => {
            popup.classList.add("hidden");
        };

        const triggerIcon = document.getElementById("triggerIcon");
        triggerIcon.addEventListener("click", () => {
            currentPage = 0;
            showPopup();
            updateContent();
        });

        const updateContent = () => {
            const page = pages[currentPage];
            const themeIcons = getThemeIcons();

            iconContainer.querySelector("img").src = themeIcons[currentPage];
            iconContainer.querySelector("img").alt = `Icon ${currentPage + 1}`;
            content.querySelector("p").innerHTML = page.text;
            content.querySelector("span").innerHTML = `[${currentPage + 1}/3]`;

            nextButton.classList.toggle("hidden", currentPage === pages.length - 1);
            closeButton.classList.toggle("hidden", currentPage !== pages.length - 1);
        };

        nextButton.addEventListener("click", () => {
            if (currentPage < pages.length - 1) {
                currentPage++;
                updateContent();
            }
        });

        closeButton.addEventListener("click", () => {
            hidePopup();
            sessionStorage.setItem("walkthroughSeen", "true");
        });

        if (!sessionStorage.getItem("walkthroughSeen")) {
            showPopup();
            updateContent();
        }
    });
</script>
{% endblock content %}
